# MercuryDesk é¡¹ç›®å®Œæ•´æ¢ç´¢æŠ¥å‘Š

**æ¢ç´¢æ—¶é—´**: 2026-02-11  
**é¡¹ç›®æ€»ä»£ç è¡Œæ•°**: ~25,804 è¡Œï¼ˆPython + TypeScript/TSXï¼‰  
**é¡¹ç›®è§„æ¨¡**: ä¸­å‹å…¨æ ˆåº”ç”¨

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è§ˆ](#é¡¹ç›®æ¦‚è§ˆ)
2. [é¡¶çº§ç›®å½•ç»“æ„](#é¡¶çº§ç›®å½•ç»“æ„)
3. [æŠ€æœ¯æ ˆè¯¦è§£](#æŠ€æœ¯æ ˆè¯¦è§£)
4. [åç«¯æ¶æ„](#åç«¯æ¶æ„)
5. [å‰ç«¯æ¶æ„](#å‰ç«¯æ¶æ„)
6. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
7. [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
8. [é…ç½®ä¸éƒ¨ç½²](#é…ç½®ä¸éƒ¨ç½²)
9. [å¼€å‘å·¥ä½œæµ](#å¼€å‘å·¥ä½œæµ)

---

## é¡¹ç›®æ¦‚è§ˆ

### é¡¹ç›®å®šä½
**MercuryDesk** æ˜¯ä¸€ä¸ª**é¢å‘ä¸ªäººå·¥ä½œæµçš„ç»Ÿä¸€æ”¶ä»¶ç®±å¹³å°**ï¼Œå…¶æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯ï¼š
- ğŸ“¬ **å¤šæºæ¶ˆæ¯èšåˆ**ï¼šå°†æ¥è‡ªé‚®ç®±ã€ç¤¾äº¤åª’ä½“ã€è®¢é˜…æºçš„æ¶ˆæ¯ç»Ÿä¸€æ”¶çº³
- ğŸ´ **æ‚å¿—å¼å¡ç‰‡å¸ƒå±€**ï¼šæŒ‰å‘ä¿¡äººåˆ†ç»„å±•ç¤ºï¼Œæ”¯æŒæµ…è‰²æµ…è“/æ·±è‰²çº¯é»‘ä¸»é¢˜
- ğŸ¤– **AI Agent æ”¯æŒ**ï¼šé›†æˆ OpenAI-Compatible LLMï¼Œæ”¯æŒè®°å¿†ä¸å·¥å…·è°ƒç”¨
- ğŸ”— **çµæ´»æ¥å…¥æ–¹å¼**ï¼šOAuthã€Tokenã€IMAPã€é‚®ä»¶è½¬å‘ç­‰å¤šç§è¿æ¥æ–¹å¼

### æ ¸å¿ƒä»·å€¼ä¸»å¼ 
- **æ¶ˆæ¯ç»Ÿä¸€åŒ–**ï¼šæ¥è‡ªä¸åŒå¹³å°çš„æ¶ˆæ¯åœ¨ä¸€ä¸ªç•Œé¢å†…ç»Ÿä¸€å±•ç¤ºä¸ç®¡ç†
- **å‘ä¿¡äººä¸­å¿ƒ**ï¼šæŒ‰ç…§å‘ä¿¡äººèšåˆæ¶ˆæ¯ï¼Œè€ŒéæŒ‰æ—¶é—´çº¿
- **è®°å¿†ä¸æ™ºèƒ½**ï¼šAgent å¯ä»¥å­¦ä¹ ç”¨æˆ·åå¥½ï¼Œæä¾›ä¸ªæ€§åŒ–ååŠ©
- **æ˜“äºæ‰©å±•**ï¼šæ–°çš„æ•°æ®æºå¯é€šè¿‡ Connector æ¨¡å¼è½»æ¾æ¥å…¥

### ä¸»è¦åŠŸèƒ½æ¨¡å—
âœ… **æ¶ˆæ¯èšåˆä¸ç®¡ç†**
- æŒ‰å‘ä¿¡äººå¡ç‰‡æ±‡æ€»æ¶ˆæ¯
- æœªè¯»ç»Ÿè®¡ä¸ä¼šè¯æŠ½å±‰
- é“¾æ¥å¯ç‚¹å‡»è·³è½¬
- æ¶ˆæ¯æ ‡è®°å·²è¯»/æœªè¯»

âœ… **å¤šæºæ•°æ®æ¥å…¥**
- ğŸ“§ **é‚®ç®±**: IMAPã€Gmail OAuthã€Outlook OAuth
- ğŸ™ **GitHub**: é€šçŸ¥åˆ—è¡¨ï¼ˆOAuth æˆ– Tokenï¼‰
- ğŸ“° **RSS/åšå®¢**: æ ‡å‡† RSS/Atom è§£æ
- ğŸ¥ **Bilibili**: UP ä¸»åŠ¨æ€ï¼ˆçˆ¬è™« + RSSHub å›é€€ï¼‰
- ğŸ¦ **X (Twitter)**: ç”¨æˆ·æ¨æ–‡ï¼ˆå®˜æ–¹ API + çˆ¬è™« + RSSHub å›é€€ï¼‰
- ğŸµ **æŠ–éŸ³**: ç”¨æˆ·è§†é¢‘ï¼ˆPlaywright + RSSHubï¼‰
- ğŸ’„ **å°çº¢ä¹¦**: ç”¨æˆ·ç¬”è®°ï¼ˆPlaywright + çˆ¬è™«ï¼‰
- ğŸ“° **å¾®åš**: ç”¨æˆ·æ—¶é—´çº¿ï¼ˆAPI + RSSHubï¼‰
- ğŸ­ **Mock**: æ¼”ç¤ºæ•°æ®

âœ… **AI Agent åŠŸèƒ½**
- æ™ºèƒ½èŠå¤©æ¥å£ï¼ˆæ”¯æŒå¤šè½®å¯¹è¯ä¸å·¥å…·è°ƒç”¨ï¼‰
- çŸ­æœŸæ‘˜è¦ + é•¿æœŸè®°å¿†ç¬”è®°
- ç„¦ç‚¹å†…å®¹æå–ï¼ˆå…³æ³¨ç‰¹å®šå‘ä¿¡äººçš„ä¿¡æ¯ï¼‰
- å®Œæ•´çš„è®°å¿†ç®¡ç† API

âœ… **é«˜çº§é…ç½®**
- OAuth åº”ç”¨é…ç½®ç®¡ç†ï¼ˆUI å†…ä¿å­˜ï¼Œæ— éœ€æ”¹ `.env`ï¼‰
- Agent æ¨¡å‹ç›®å½•ï¼ˆæ¥è‡ª `models.dev`ï¼‰
- é‚®ä»¶è½¬å‘æ¥å…¥ï¼ˆæœ€ç®€é…ç½®ï¼‰
- åŠ å¯†å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆæ”¯æŒ Fernetï¼‰

---

## é¡¶çº§ç›®å½•ç»“æ„

```
MercuryDesk/
â”œâ”€â”€ backend/                    # Python FastAPI åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ app/                    # ä¸»åº”ç”¨ä»£ç ï¼ˆ~7,457 è¡Œ Pythonï¼‰
â”‚   â”‚   â”œâ”€â”€ connectors/         # 12+ æ•°æ®æºè¿æ¥å™¨
â”‚   â”‚   â”œâ”€â”€ routers/            # 6 ä¸ª API è·¯ç”±æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡æœåŠ¡å±‚ï¼ˆLLMã€åŠ å¯†ã€OAuth ç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ models.py           # SQLAlchemy ORM æ¨¡å‹ï¼ˆ10 å¼ è¡¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ crud.py             # æ•°æ®åº“æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ main.py             # FastAPI åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ settings.py         # ç¯å¢ƒå˜é‡é…ç½®
â”‚   â”‚   â”œâ”€â”€ schemas.py          # Pydantic æ•°æ®éªŒè¯
â”‚   â”‚   â”œâ”€â”€ security.py         # JWT è®¤è¯
â”‚   â”‚   â”œâ”€â”€ db.py               # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â””â”€â”€ sync.py             # åŒæ­¥ä»»åŠ¡ç¼–æ’
â”‚   â”œâ”€â”€ tests/                  # å•å…ƒæµ‹è¯•ï¼ˆ~40KBï¼‰
â”‚   â”œâ”€â”€ requirements.txt         # Python ä¾èµ–ï¼ˆ14 ä¸ªåŒ…ï¼‰
â”‚   â”œâ”€â”€ .env.example            # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚   â””â”€â”€ README.md               # åç«¯è¯´æ˜
â”‚
â”œâ”€â”€ frontend/                   # React + TypeScript å‰ç«¯
â”‚   â”œâ”€â”€ src/                    # å‰ç«¯æºä»£ç 
â”‚   â”‚   â”œâ”€â”€ components/         # React ç»„ä»¶ï¼ˆ11 ä¸ªä¸»ç»„ä»¶ + å­ç»„ä»¶ï¼‰
â”‚   â”‚   â”œâ”€â”€ contexts/           # React Contextï¼ˆè®¤è¯ã€Toastï¼‰
â”‚   â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰ React Hooks
â”‚   â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ api.ts              # API å®¢æˆ·ç«¯ï¼ˆ~500 è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ theme.tsx           # MUI ä¸»é¢˜é…ç½®
â”‚   â”‚   â”œâ”€â”€ App.tsx             # åº”ç”¨ä¸»ç»„ä»¶
â”‚   â”‚   â””â”€â”€ styles.css          # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ public/                 # é™æ€èµ„æº
â”‚   â”œâ”€â”€ package.json            # Node.js ä¾èµ–
â”‚   â”œâ”€â”€ vite.config.ts          # Vite æ„å»ºé…ç½®
â”‚   â””â”€â”€ index.html              # HTML å…¥å£
â”‚
â”œâ”€â”€ docs/                       # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ architecture-status.md  # æ¶æ„å¿«ç…§è¡¨
â”‚   â”œâ”€â”€ email-forwarding.md     # é‚®ä»¶è½¬å‘è¯´æ˜
â”‚   â”œâ”€â”€ Agent_ç¬¬ä¸€æœŸ.md         # Agent è®¾è®¡æ–‡æ¡£
â”‚   â””â”€â”€ test*.md                # æµ‹è¯•æŠ¥å‘Š
â”‚
â”œâ”€â”€ tests/                      # é›†æˆæµ‹è¯•ç›®å½•
â”œâ”€â”€ README.md                   # ä¸»é¡¹ç›®è¯´æ˜ï¼ˆè¯¦ç»†çš„å¿«é€Ÿå¯åŠ¨æŒ‡å—ï¼‰
â”œâ”€â”€ report.md                   # é¡¹ç›®æŠ¥å‘Šï¼ˆ~33KBï¼‰
â””â”€â”€ .gitignore                  # Git å¿½ç•¥è§„åˆ™
```

---

## æŠ€æœ¯æ ˆè¯¦è§£

### åç«¯æŠ€æœ¯æ ˆ
| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| **Web æ¡†æ¶** | FastAPI | â‰¥0.110 | é«˜æ€§èƒ½å¼‚æ­¥ API æ¡†æ¶ |
| **Web æœåŠ¡å™¨** | Uvicorn | â‰¥0.24 | ASGI åº”ç”¨æœåŠ¡å™¨ |
| **ORM** | SQLAlchemy | â‰¥2.0 | æ•°æ®åº“ ORM |
| **æ•°æ®åº“** | SQLiteï¼ˆé»˜è®¤ï¼‰/ PostgreSQL | - | æ•°æ®æŒä¹…åŒ– |
| **æ•°æ®éªŒè¯** | Pydantic | â‰¥2.0 | è¯·æ±‚/å“åº”éªŒè¯ |
| **è®¤è¯** | python-jose | â‰¥3.3 | JWT ä»¤ç‰Œç”Ÿæˆä¸éªŒè¯ |
| **åŠ å¯†** | cryptography | â‰¥41.0 | æ•æ„Ÿä¿¡æ¯åŠ å¯†ï¼ˆFernetï¼‰ |
| **HTTP å®¢æˆ·ç«¯** | httpx | â‰¥0.25 | å¼‚æ­¥ HTTP è¯·æ±‚ |
| **RSS è§£æ** | feedparser | â‰¥6.0 | RSS/Atom æºè§£æ |
| **ç½‘é¡µçˆ¬è™«** | Playwright | â‰¥1.40 | æ— å¤´æµè§ˆå™¨è‡ªåŠ¨åŒ– |
| **æµ‹è¯•** | pytest | â‰¥7.0 | å•å…ƒæµ‹è¯•æ¡†æ¶ |
| **LLM** | OpenAI SDK | â‰¥1.0.0 | æ¨¡å‹ API è°ƒç”¨ |

**æ ¸å¿ƒä¾èµ–ç‰¹ç‚¹**:
- âœ… å¼‚æ­¥ä¼˜å…ˆï¼šFastAPI + Uvicorn + httpx å…¨å¼‚æ­¥å †æ ˆ
- âœ… ç±»å‹å®‰å…¨ï¼šPydantic ä¸ SQLAlchemy çš„å¼ºç±»å‹æ”¯æŒ
- âœ… çˆ¬è™«èƒ½åŠ›ï¼šPlaywright æ”¯æŒåŠ¨æ€ç½‘é¡µæŠ“å–
- âœ… å®‰å…¨åŠ å¯†ï¼šæ”¯æŒ Fernet åŠ å¯†å­˜å‚¨æ•æ„Ÿæ•°æ®

### å‰ç«¯æŠ€æœ¯æ ˆ
| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| **æ¡†æ¶** | React | ^18.2.0 | UI ç»„ä»¶æ¡†æ¶ |
| **è¯­è¨€** | TypeScript | ^5.4.5 | ç±»å‹å®‰å…¨çš„ JavaScript |
| **æ„å»ºå·¥å…·** | Vite | ^5.2.0 | å¿«é€Ÿæ„å»ºå·¥å…· |
| **UI ç»„ä»¶åº“** | Material-UI (MUI) | ^7.3.7 | ä¼ä¸šçº§ UI ç»„ä»¶ |
| **æ ·å¼è§£å†³æ–¹æ¡ˆ** | Emotion | ^11.14.0 | CSS-in-JS åº“ |
| **è·¯ç”±** | React Router | ^7.13.0 | å•é¡µåº”ç”¨è·¯ç”± |
| **åŠ¨ç”»** | Framer Motion | ^12.33.0 | æµç•…åŠ¨ç”»åº“ |
| **æ•°æ®è·å–** | SWR | ^2.2.5 | React Hooks æ•°æ®è·å– |
| **Markdown æ¸²æŸ“** | react-markdown | ^10.1.0 | Markdown è§£ææ¸²æŸ“ |
| **æ—¥æœŸå¤„ç†** | date-fns | ^4.1.0 | è½»é‡æ—¥æœŸå·¥å…·åº“ |
| **æµ‹è¯•** | Vitest | ^1.5.0 | å•å…ƒæµ‹è¯•æ¡†æ¶ |
| **æµ‹è¯•åº“** | React Testing Library | ^15.0.7 | React ç»„ä»¶æµ‹è¯• |

**å‰ç«¯æ¶æ„ç‰¹ç‚¹**:
- âœ… ç°ä»£åŒ–å †æ ˆï¼šReact 18 + TypeScript + Vite
- âœ… å“åº”å¼ UIï¼šMUI ç»„ä»¶åº“ + Emotion æ ·å¼
- âœ… å®æ—¶æ›´æ–°ï¼šSWR æ”¯æŒè‡ªåŠ¨æ•°æ®åˆ·æ–°ä¸ç¼“å­˜
- âœ… åŠ¨ç”»ä½“éªŒï¼šFramer Motion æä¾›æµç•…è¿‡æ¸¡
- âœ… ç±»å‹å®‰å…¨ï¼šå®Œæ•´çš„ TypeScript æ”¯æŒ

---

## åç«¯æ¶æ„

### ç›®å½•ç»“æ„è¯¦è§£

#### 1. **connectors/** - æ•°æ®æºè¿æ¥å™¨ï¼ˆ12+ æ¨¡å—ï¼‰

æ¯ä¸ª Connector å®ç° `BaseCrawler` æ¥å£ï¼Œè´Ÿè´£ä»ç‰¹å®šå¹³å°æŠ“å–æ•°æ®ã€‚

| æ–‡ä»¶ | è¡Œæ•° | ä¸»è¦åŠŸèƒ½ |
|------|------|---------|
| `base.py` | ~50 | åŸºç±»å®šä¹‰ |
| `mock.py` | ~50 | æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆ |
| `github.py` | ~80 | GitHub é€šçŸ¥ï¼ˆREST APIï¼‰ |
| `gmail.py` | ~150 | Gmail API é›†æˆ |
| `outlook.py` | ~120 | Microsoft Graph é›†æˆ |
| `imap.py` | ~250 | IMAP é€šç”¨é‚®ç®±åè®® |
| `feed.py` | ~350 | RSS/Atom è®¢é˜…æº |
| `x.py` | **1,200+** | X (Twitter) å¤šç­–ç•¥çˆ¬è™«ï¼ˆå®˜æ–¹ API + GraphQL + RSSHub + fallbackï¼‰ |
| `bilibili.py` | **900+** | Bilibili UP ä¸»ï¼ˆAPI + WBI + Playwright + RSSHubï¼‰ |
| `douyin.py` | ~600 | æŠ–éŸ³ç”¨æˆ·è§†é¢‘ï¼ˆPlaywright + RSSHubï¼‰ |
| `xiaohongshu.py` | ~700 | å°çº¢ä¹¦ç¬”è®°ï¼ˆPlaywright + jina.ai + RSSHubï¼‰ |
| `weibo.py` | ~450 | å¾®åšæ—¶é—´çº¿ï¼ˆm.weibo.cn API + RSSHubï¼‰ |

**å…³é”®è®¾è®¡**:
- **ç­–ç•¥æ¨¡å¼**ï¼šæ¯ä¸ª Connector æ”¯æŒå¤šä¸ªæŠ“å–ç­–ç•¥ï¼ˆä¸»ç­–ç•¥ â†’ å›é€€ç­–ç•¥ï¼‰
- **å¹¶å‘æ§åˆ¶**ï¼šé€šè¿‡çº¿ç¨‹æ±  (`sync_job_max_workers=12`) ç®¡ç†å¹¶å‘
- **å®¹é”™æœºåˆ¶**ï¼šç­–ç•¥å¤±è´¥è‡ªåŠ¨å›é€€ï¼ˆå¦‚çˆ¬è™«å¤±è´¥ â†’ RSSHubï¼‰
- **æ•°æ®è§„èŒƒåŒ–**ï¼šæ‰€æœ‰ Connector è¾“å‡ºç»Ÿä¸€çš„ `Message` å¯¹è±¡

#### 2. **routers/** - API è·¯ç”±ï¼ˆ6 ä¸ªæ¨¡å—ï¼‰

| æ–‡ä»¶ | è¡Œæ•° | ä¸»è¦ç«¯ç‚¹ |
|------|------|---------|
| `auth.py` | ~150 | `/auth/register`, `/auth/login`, `/auth/me` |
| `accounts.py` | **650+** | è´¦æˆ·ç®¡ç†ã€OAuth æµç¨‹ã€æ•°æ®æºé…ç½®ã€åŒæ­¥è°ƒåº¦ |
| `contacts.py` | ~100 | è”ç³»äººåˆ—è¡¨ã€è¯¦æƒ…ã€åˆ é™¤ |
| `messages.py` | ~30 | æ¶ˆæ¯åˆ—è¡¨ã€æ ‡è®°å·²è¯» |
| `agent.py` | **500+** | èŠå¤©ã€è®°å¿†ç®¡ç†ã€æ¨¡å‹é…ç½®ã€å·¥å…·è°ƒç”¨ |
| `inbound.py` | **350+** | é‚®ä»¶è½¬å‘æ¥å…¥ã€éªŒè¯ |

**å…³é”®è·¯ç”±**:
```
POST   /api/v1/auth/register              # æ³¨å†Œ
POST   /api/v1/auth/login                 # ç™»å½•
GET    /api/v1/accounts                   # è·å–å·²è¿æ¥è´¦æˆ·
POST   /api/v1/accounts/{provider}/sync   # æ‰‹åŠ¨åŒæ­¥
POST   /api/v1/agent/chat                 # AI å¯¹è¯
GET    /api/v1/agent/config               # Agent é…ç½®
PATCH  /api/v1/agent/config               # æ›´æ–° Agent é…ç½®
POST   /api/v1/inbound/forward            # é‚®ä»¶è½¬å‘å…¥ç«™
```

#### 3. **services/** - ä¸šåŠ¡æœåŠ¡å±‚ï¼ˆ12 ä¸ªæ¨¡å—ï¼‰

| æ–‡ä»¶ | è¡Œæ•° | èŒè´£ |
|------|------|------|
| `llm.py` | ~250 | LLM è°ƒç”¨ï¼ˆæ”¯æŒå·¥å…·è°ƒç”¨ã€å¤šè½®å¯¹è¯ï¼‰ |
| `agent_memory.py` | **500+** | è®°å¿†ç®¡ç†ï¼ˆæ‘˜è¦ã€ç¬”è®°ã€ç„¦ç‚¹å†…å®¹æå–ï¼‰ |
| `agent_tools.py` | ~150 | Agent å·¥å…·å®šä¹‰ï¼ˆæœç´¢æ¶ˆæ¯ã€è·å–è”ç³»äººä¿¡æ¯ï¼‰ |
| `oauth_clients.py` | **350+** | OAuth è®¤è¯æµç¨‹ï¼ˆGmailã€Outlookã€GitHubï¼‰ |
| `model_catalog.py` | ~150 | æ¨¡å‹ç›®å½•ç¼“å­˜ä¸æ›´æ–° |
| `encryption.py` | ~50 | Fernet åŠ å¯†/è§£å¯† |
| `avatar.py` | ~50 | å¤´åƒç®¡ç† |
| `feed_urls.py` | ~20 | é¢„è®¾è®¢é˜…æº URL |
| `forwarding.py` | ~50 | é‚®ä»¶è½¬å‘åœ°å€ç”Ÿæˆ |
| `oauth_state.py` | ~50 | OAuth çŠ¶æ€ç®¡ç† |
| `summarizer.py` | ~30 | æ¶ˆæ¯æ‘˜è¦ï¼ˆå ä½ç¬¦ï¼‰ |
| `sync_jobs.py` | ~150 | åŒæ­¥ä»»åŠ¡ç®¡ç† |

**æ ¸å¿ƒæœåŠ¡**:
- **LLM**: OpenAI-Compatible åè®®ï¼Œæ”¯æŒå·¥å…·è°ƒç”¨é“¾è·¯
- **Agent Memory**: çŸ­æœŸæ‘˜è¦ + é•¿æœŸç¬”è®° + ç„¦ç‚¹å†…å®¹
- **OAuth**: ä¸‰æ–¹å¹³å° (Gmail/Outlook/GitHub) æˆæƒæµç¨‹
- **Encryption**: æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨

#### 4. **æ ¸å¿ƒæ¨¡å—**

| æ–‡ä»¶ | è¡Œæ•° | åŠŸèƒ½ |
|------|------|------|
| `models.py` | ~450 | SQLAlchemy ORM æ¨¡å‹ï¼ˆ10 å¼ è¡¨ï¼‰ |
| `crud.py` | ~500 | æ•°æ®åº“å¢åˆ æ”¹æŸ¥æ“ä½œ |
| `schemas.py` | ~250 | Pydantic è¯·æ±‚/å“åº”æ•°æ®æ¨¡å‹ |
| `security.py` | ~50 | JWT ä»¤ç‰Œç”Ÿæˆä¸éªŒè¯ |
| `db.py` | ~50 | æ•°æ®åº“è¿æ¥ä¸ä¼šè¯ç®¡ç† |
| `sync.py` | **650+** | åŒæ­¥ä»»åŠ¡æ ¸å¿ƒç¼–æ’ |
| `settings.py` | ~55 | ç¯å¢ƒå˜é‡é…ç½®ç®¡ç† |
| `main.py` | ~75 | FastAPI åº”ç”¨åˆå§‹åŒ– |

### æ•°æ®åº“æ¨¡å‹ï¼ˆ10 å¼ è¡¨ï¼‰

```
users                          # ç”¨æˆ·è´¦æˆ·
â”œâ”€â”€ id, email, hashed_password, avatar_url

connected_accounts            # å·²è¿æ¥çš„æ•°æ®æºè´¦æˆ·
â”œâ”€â”€ id, user_id, provider (imap/gmail/github/x/bilibili...), identifier
â”œâ”€â”€ access_token, refresh_token, last_synced_at

imap_account_configs          # IMAP é‚®ç®±é…ç½®
â”œâ”€â”€ account_id, host, port, username, password (encrypted)

feed_account_configs          # RSS è®¢é˜…æºé…ç½®
â”œâ”€â”€ account_id, feed_url, homepage_url, display_name

forward_account_configs       # é‚®ä»¶è½¬å‘é…ç½®
â”œâ”€â”€ account_id, inbound_secret

oauth_credential_configs      # OAuth åº”ç”¨é…ç½®ï¼ˆä¿å­˜ client_id/secretï¼‰
â”œâ”€â”€ id, user_id, provider, client_id, client_secret

agent_configs                 # AI Agent é…ç½®
â”œâ”€â”€ user_id, provider, base_url, model, api_key (encrypted)

x_api_configs                 # X (Twitter) API é…ç½®
â”œâ”€â”€ user_id, bearer_token, auth_cookies (JSON)

agent_conversation_memories   # Agent å¯¹è¯è®°å¿†
â”œâ”€â”€ user_id, summary

agent_memory_notes            # Agent è®°å¿†ç¬”è®°
â”œâ”€â”€ id, user_id, kind, content, source

contacts                      # è”ç³»äºº
â”œâ”€â”€ id, user_id, display_name, handle, avatar_url, last_message_at

messages                      # æ¶ˆæ¯
â”œâ”€â”€ id, user_id, contact_id, source, external_id
â”œâ”€â”€ sender, subject, body, body_preview, received_at, is_read, summary
```

### API è®¤è¯ä¸æˆæƒ

- **JWT ä»¤ç‰Œ**ï¼šä½¿ç”¨ `python-jose` ç”Ÿæˆä¸éªŒè¯
- **ä»¤ç‰Œè¿‡æœŸ**ï¼šé»˜è®¤ 24 å°æ—¶ï¼ˆå¯é…ç½®ï¼‰
- **å®‰å…¨å­˜å‚¨**ï¼šæ•æ„Ÿä¿¡æ¯ï¼ˆTokenã€å¯†ç ã€API Keyï¼‰æ”¯æŒ Fernet åŠ å¯†
- **CORS**ï¼šå¯é…ç½®å…è®¸çš„æ¥æº

---

## å‰ç«¯æ¶æ„

### ç›®å½•ç»“æ„è¯¦è§£

#### 1. **components/** - React ç»„ä»¶ï¼ˆ11+ ä¸»ç»„ä»¶ï¼‰

| ç»„ä»¶ | è¡Œæ•° | åŠŸèƒ½ |
|------|------|------|
| `Dashboard.tsx` | ~400 | ä¸»ä»ªè¡¨æ¿ï¼ˆæ¶ˆæ¯å¡ç‰‡ç½‘æ ¼ã€åŒæ­¥æ§åˆ¶ï¼‰ |
| `ContactGrid.tsx` | ~600 | è”ç³»äººå¡ç‰‡ç½‘æ ¼ï¼ˆæ‹–æ‹½ã€è™šæ‹Ÿæ»šåŠ¨ï¼‰ |
| `ContactCard.tsx` | ~500 | å•ä¸ªè”ç³»äººå¡ç‰‡ï¼ˆæ¶ˆæ¯é¢„è§ˆã€æœªè¯»è®¡æ•°ï¼‰ |
| `ConversationDrawer.tsx` | ~550 | å¯¹è¯æŠ½å±‰ï¼ˆå±•å¼€å¯¹è¯å†å²ï¼‰ |
| `AgentChatPanel.tsx` | **600+** | AI å¯¹è¯é¢æ¿ï¼ˆå¤šè½®èŠå¤©ã€å·¥å…·è°ƒç”¨ã€è®°å¿†å±•ç¤ºï¼‰ |
| `Settings.tsx` | ~300 | è®¾ç½®ä¸»é¡µé¢ï¼ˆå¯¼èˆªï¼‰ |
| `settings/sections/AccountsSection.tsx` | **2,400+** | è´¦æˆ·ç®¡ç†ï¼ˆOAuthã€Tokenã€IMAP é…ç½®ï¼‰ |
| `settings/sections/AgentSection.tsx` | ~280 | Agent é…ç½®ï¼ˆæ¨¡å‹é€‰æ‹©ã€API Keyï¼‰ |
| `settings/sections/AppearanceSection.tsx` | ~50 | ä¸»é¢˜åˆ‡æ¢ |
| `settings/sections/ProfileSection.tsx` | ~90 | ä¸ªäººèµ„æ–™ |
| `Dashboard/SyncProgressPanel.tsx` | ~50 | åŒæ­¥è¿›åº¦æ¡ |
| `Dashboard/GmailBindDialog.tsx` | ~50 | Gmail ç»‘å®šæç¤º |
| `TopBar.tsx` | ~220 | é¡¶éƒ¨å¯¼èˆªæ  |
| `Login.tsx` | ~100 | ç™»å½•é¡µ |
| `login/LoginPanel.tsx` | ~200 | ç™»å½•è¡¨å• |
| `ErrorBoundary.tsx` | ~90 | é”™è¯¯è¾¹ç•Œ |
| `GuideCards.tsx` | ~200 | å¼•å¯¼å¡ç‰‡ |
| `NotFound.tsx` | ~10 | 404 é¡µé¢ |
| `ContactSkeleton.tsx` | ~50 | åŠ è½½éª¨æ¶å± |

**å…³é”®ç»„ä»¶ç‰¹ç‚¹**:
- **Dashboard**: ä½¿ç”¨å¡ç‰‡ç½‘æ ¼å±•ç¤ºæ‰€æœ‰è”ç³»äººï¼Œæ”¯æŒæ‹–æ‹½æ’åºã€è™šæ‹Ÿæ»šåŠ¨
- **AccountsSection**: é«˜åº¦å¤æ‚ï¼Œæ”¯æŒå¤šä¸ªæ•°æ®æºçš„é…ç½®ä¸ç®¡ç†
- **AgentChatPanel**: å®Œæ•´çš„å¯¹è¯ UIï¼Œæ”¯æŒå·¥å…·è°ƒç”¨ä¸è®°å¿†æ³¨å…¥

#### 2. **contexts/** - React Contextï¼ˆå…¨å±€çŠ¶æ€ï¼‰

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `AuthContext.tsx` | è®¤è¯çŠ¶æ€ï¼ˆç”¨æˆ·ã€ç™»å½•çŠ¶æ€ã€ç™»å‡ºï¼‰ |
| `ToastContext.tsx` | æ¶ˆæ¯é€šçŸ¥ï¼ˆToast/Snackbarï¼‰ |

#### 3. **hooks/** - è‡ªå®šä¹‰ React Hooks

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `useConfirmDialog.tsx` | ç¡®è®¤å¯¹è¯æ¡†é€»è¾‘ |
| `useDebouncedValue.ts` | é˜²æŠ–å€¼ |

#### 4. **utils/** - å·¥å…·å‡½æ•°

| æ–‡ä»¶ | è¡Œæ•° | åŠŸèƒ½ |
|------|------|------|
| `contentPreview.ts` | ~400 | HTML/Markdown å†…å®¹é¢„è§ˆç”Ÿæˆ |
| `oauthPopup.ts` | ~100 | OAuth å¼¹çª—ç®¡ç† |

#### 5. **å…¶ä»–æ–‡ä»¶**

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `api.ts` | API å®¢æˆ·ç«¯ï¼ˆæ‰€æœ‰åç«¯è°ƒç”¨çš„å…¥å£ï¼‰ |
| `theme.tsx` | MUI ä¸»é¢˜é…ç½®ï¼ˆæµ…è‰²ã€æ·±è‰²ä¸»é¢˜ï¼‰ |
| `App.tsx` | åº”ç”¨ä¸»ç»„ä»¶ä¸è·¯ç”±è®¾ç½® |
| `main.tsx` | React DOM æ¸²æŸ“å…¥å£ |
| `styles.css` | å…¨å±€æ ·å¼ |

### å‰ç«¯ API è°ƒç”¨æ¶æ„

**api.ts** (~500 è¡Œ) æä¾›å®Œæ•´çš„ç±»å‹å®šä¹‰ä¸ API åŒ…è£…ï¼š

```typescript
// ç±»å‹å®šä¹‰
export type User, ConnectedAccount, Contact, Message, AgentConfig, ...

// è®¤è¯
export async function register(email, password)
export async function login(email, password)
export async function logout()

// è´¦æˆ·ç®¡ç†
export async function getConnectedAccounts()
export async function syncAccount(provider)
export async function deleteAccount(accountId)

// æ¶ˆæ¯
export async function getContacts(options)
export async function getMessages(contactId)
export async function markMessagesAsRead(messageIds)

// Agent
export async function agentChat(messages, tools, useMemory)
export async function getAgentConfig()
export async function updateAgentConfig(config)
export async function getAgentMemory()

// OAuth
export async function startOAuth(provider)
export async function completeOAuth(provider, code)

// å·¥å…·å‡½æ•°
export function getToken()
export function setToken(token)
export class ApiError extends Error
```

### æ•°æ®æµ

1. **è·å–æ•°æ®**: SWR Hook è‡ªåŠ¨å¤„ç†ç¼“å­˜ã€åˆ·æ–°ã€é”™è¯¯é‡è¯•
2. **æ˜¾ç¤ºæ•°æ®**: React ç»„ä»¶è®¢é˜… SWR æ•°æ®ï¼Œè‡ªåŠ¨æ¸²æŸ“
3. **æ›´æ–°æ•°æ®**: è°ƒç”¨ API åï¼Œé€šè¿‡ `mutate()` è§¦å‘ SWR é‡æ–°éªŒè¯
4. **é”™è¯¯å¤„ç†**: ApiError æ•è· HTTP é”™è¯¯ï¼Œæ˜¾ç¤ºä¸º Toast é€šçŸ¥

---

## æ•°æ®æ¨¡å‹

### ç”¨æˆ·ç›¸å…³
```python
User(
  id: int,
  email: str,          # å”¯ä¸€
  hashed_password: str,
  avatar_url: str,
  created_at: datetime
)
```

### è´¦æˆ·ç®¡ç†
```python
ConnectedAccount(
  id: int,
  user_id: int,
  provider: str,         # 'imap', 'gmail', 'github', 'x', 'bilibili', ...
  identifier: str,       # email æˆ– username
  access_token: str,     # OAuth/API token
  refresh_token: str,    # OAuth refresh token
  last_synced_at: datetime
)

# æ‰©å±•é…ç½®ï¼ˆå¤šæ€å…³ç³»ï¼‰
ImapAccountConfig         # host, port, username, password (encrypted)
FeedAccountConfig         # feed_url, homepage_url, display_name
ForwardAccountConfig      # inbound_secret (ç”¨äºéªŒè¯è½¬å‘é‚®ä»¶)
OAuthCredentialConfig     # client_id, client_secret (OAuth åº”ç”¨é…ç½®)
```

### æ¶ˆæ¯ä¸è”ç³»äºº
```python
Contact(
  id: int,
  user_id: int,
  display_name: str,
  handle: str,           # email æˆ– username
  avatar_url: str,
  last_message_at: datetime
)

Message(
  id: int,
  user_id: int,
  contact_id: int,
  source: str,           # 'email', 'github', 'news', 'x', ...
  external_id: str,      # å¹³å°æ–¹æ¶ˆæ¯ IDï¼ˆç”¨äºå»é‡ï¼‰
  sender: str,
  subject: str,
  body: str,
  body_preview: str,     # æ‘˜è¦ç”¨äºåˆ—è¡¨å±•ç¤º
  received_at: datetime,
  is_read: bool,
  summary: str           # LLM ç”Ÿæˆçš„æ‘˜è¦ï¼ˆå¯é€‰ï¼‰
)
```

### Agent ä¸è®°å¿†
```python
AgentConfig(
  user_id: int,
  provider: str,         # 'rule_based' æˆ– 'openai'
  base_url: str,
  model: str,
  temperature: float,
  api_key: str           # (encrypted)
)

AgentConversationMemory(
  user_id: int,
  summary: str           # å¯¹è¯æ€»ç»“
)

AgentMemoryNote(
  id: int,
  user_id: int,
  kind: str,             # 'note', 'preference', 'action', ...
  content: str,
  source: str            # æ¥æºï¼ˆå¦‚ 'contact_name'ï¼‰
)
```

---

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. åŒæ­¥ä¸çˆ¬è™«ç³»ç»Ÿ (`sync.py`)

**æ ¸å¿ƒæµç¨‹**ï¼š
1. ç”¨æˆ·è§¦å‘"åŒæ­¥å…¨éƒ¨"æˆ–å®šæ—¶ä»»åŠ¡è°ƒç”¨ `sync_account(user_id, provider)`
2. æ ¹æ® Provider é€‰æ‹©å¯¹åº”çš„ Connector
3. Connector æ‰§è¡Œä¸»ç­–ç•¥ï¼Œå¤±è´¥åˆ™å›é€€åˆ°å¤‡é€‰ç­–ç•¥
4. æŠ“å–çš„æ¶ˆæ¯è§„èŒƒåŒ–ä¸º `Message` å¯¹è±¡
5. å†™å…¥æ•°æ®åº“ï¼Œæ›´æ–° `Contact.last_message_at`

**å¹¶å‘æ§åˆ¶**ï¼š
```python
# backend/app/settings.py
sync_job_max_workers = 12      # åŒæ­¥ä»»åŠ¡çº¿ç¨‹æ± 
crawler_rsshub_parallelism = 12 # RSSHub é•œåƒå¹¶å‘
```

**ç‰¹æ®Šå¤„ç†**ï¼š
- **X (Twitter)**: å®˜æ–¹ API â†’ GraphQL Cookie â†’ RSSHub â†’ Fallback Feed
- **Bilibili**: API â†’ WBI â†’ jina.ai â†’ RSSHub â†’ Playwright
- **Douyin/å°çº¢ä¹¦**: Playwright â†’ RSSHub å¤šé•œåƒ

### 2. OAuth è®¤è¯ç³»ç»Ÿ (`services/oauth_clients.py`)

**æ”¯æŒçš„ä¸‰æ–¹å¹³å°**ï¼š
- Gmail (Google Cloud OAuth)
- Outlook (Microsoft Entra OAuth)
- GitHub (GitHub Developers OAuth)

**æµç¨‹**ï¼š
1. ç”¨æˆ·ç‚¹å‡»"ä¸€é”®æˆæƒ"
2. å‰ç«¯å¼¹çª—æ‰“å¼€ `https://accounts.google.com/o/oauth2/auth?...`
3. ç”¨æˆ·æˆæƒï¼Œé‡å®šå‘åˆ° `backend/callback`
4. åç«¯äº¤æ¢ Authorization Code ä¸º Access Token
5. ä¿å­˜ Token åˆ° `ConnectedAccount.access_token`
6. å‰ç«¯å…³é—­å¼¹çª—ï¼Œå¼€å§‹é¦–æ¬¡åŒæ­¥

**æ”¯æŒçš„ Token åˆ·æ–°**ï¼š
- Gmail/Outlook: è‡ªåŠ¨åˆ·æ–° Refresh Token
- GitHub: Token ä¸è¿‡æœŸï¼Œä½†å¯æ‰‹åŠ¨æ›´æ–°

### 3. æ¶ˆæ¯èšåˆä¸å±•ç¤º

**åç«¯èšåˆé€»è¾‘**ï¼š
```python
# æŒ‰å‘ä¿¡äººåˆ†ç»„æŸ¥è¯¢
SELECT contact, COUNT(*) as unread_count, MAX(received_at)
FROM messages
WHERE user_id = ? AND is_read = False
GROUP BY contact_id
ORDER BY MAX(received_at) DESC
```

**å‰ç«¯å±•ç¤º**ï¼š
- **ContactGrid**: ç½‘æ ¼å¸ƒå±€ï¼Œæ¯ä¸ªå¡ç‰‡ä»£è¡¨ä¸€ä¸ªå‘ä¿¡äºº
- **ContactCard**: æ˜¾ç¤ºå‘ä¿¡äººå¤´åƒã€åç§°ã€æœªè¯»è®¡æ•°ã€æœ€æ–°æ¶ˆæ¯é¢„è§ˆ
- **ConversationDrawer**: å±•å¼€æŸ¥çœ‹è¯¥å‘ä¿¡äººçš„æ‰€æœ‰æ¶ˆæ¯

### 4. AI Agent ç³»ç»Ÿ

**æ¶æ„åˆ†å±‚**ï¼š
```
API å±‚ (routers/agent.py)
  â†“
Prompt ç»„è£… (ç³»ç»Ÿæç¤º + è®°å¿†ä¸Šä¸‹æ–‡)
  â†“
LLM è°ƒç”¨ (services/llm.py - OpenAI-Compatible)
  â†“
å·¥å…·æ‰§è¡Œ (agent_tools.py - search_messages / get_contact_info)
  â†“
è®°å¿†æ›´æ–° (agent_memory.py - æ‘˜è¦ã€ç¬”è®°ã€ç„¦ç‚¹)
```

**å·¥å…·è°ƒç”¨é“¾è·¯**ï¼š
- æœ€å¤š 3 è½®å¯¹è¯ Ã— 6 æ¬¡å·¥å…·è°ƒç”¨
- æ”¯æŒåŠ¨æ€å·¥å…·ç™½åå•ï¼ˆæ¯æ¡æ¶ˆæ¯å¯æŒ‡å®šå…è®¸å“ªäº›å·¥å…·ï¼‰
- å·¥å…·æ‰§è¡Œç»“æœæ³¨å…¥ä¸‹ä¸€è½® LLM è¾“å…¥

**è®°å¿†ç³»ç»Ÿ**ï¼š
1. **çŸ­æœŸæ‘˜è¦**: æ¯æ¬¡å¯¹è¯åç”Ÿæˆæ‘˜è¦ï¼Œå­˜å‚¨åœ¨ `AgentConversationMemory.summary`
2. **é•¿æœŸç¬”è®°**: ç”¨æˆ·æ‰‹å·¥åˆ›å»ºç¬”è®°ï¼Œå­˜å‚¨åœ¨ `AgentMemoryNote`
3. **ç„¦ç‚¹å†…å®¹**: è‡ªåŠ¨ä»æœ€è¿‘æ¶ˆæ¯ä¸­æå–å…³é”®ä¿¡æ¯ï¼ˆåŸºäºè¯„åˆ†ï¼‰

### 5. é‚®ä»¶è½¬å‘æ¥å…¥ (`routers/inbound.py`)

**å·¥ä½œæµ**ï¼š
1. ç”¨æˆ·åœ¨è®¾ç½®ä¸­é€‰æ‹©"é‚®ä»¶è½¬å‘æ¥å…¥"
2. åç«¯ç”Ÿæˆä¸“å±è½¬å‘åœ°å€ï¼ˆå¦‚ `md-xxx@inbox.example.com`ï¼‰
3. ç”¨æˆ·åœ¨åŸé‚®ç®±åå°æ·»åŠ è‡ªåŠ¨è½¬å‘è§„åˆ™
4. æ–°é‚®ä»¶åˆ°è¾¾åï¼ŒMTA è½¬å‘åˆ°ç³»ç»Ÿï¼Œè°ƒç”¨ `/api/v1/inbound/forward`
5. åç«¯éªŒè¯ `inbound_secret`ï¼Œå†™å…¥æ•°æ®åº“

**å…³é”®å‚æ•°**ï¼š
```python
MERCURYDESK_FORWARD_INBOUND_DOMAIN = "inbox.example.com"
```

---

## é…ç½®ä¸éƒ¨ç½²

### ç¯å¢ƒå˜é‡æ¸…å•

#### æ•°æ®åº“ä¸å¯†é’¥
```env
MERCURYDESK_DATABASE_URL=sqlite+pysqlite:///./mercurydesk.db
MERCURYDESK_SECRET_KEY=change-me
MERCURYDESK_FERNET_KEY=                              # ç”¨äºåŠ å¯†æ•æ„Ÿä¿¡æ¯
```

#### CORS ä¸å‰ç«¯
```env
MERCURYDESK_CORS_ORIGINS=http://localhost:5173,http://127.0.0.1:5173
MERCURYDESK_MEDIA_DIR=./media
MERCURYDESK_FRONTEND_URL=http://127.0.0.1:5173
MERCURYDESK_API_PUBLIC_BASE_URL=http://127.0.0.1:8000
```

#### OAuth åº”ç”¨ï¼ˆå…¨å±€é»˜è®¤ï¼‰
```env
MERCURYDESK_GMAIL_CLIENT_ID=...
MERCURYDESK_GMAIL_CLIENT_SECRET=...
MERCURYDESK_OUTLOOK_CLIENT_ID=...
MERCURYDESK_OUTLOOK_CLIENT_SECRET=...
MERCURYDESK_GITHUB_CLIENT_ID=...
MERCURYDESK_GITHUB_CLIENT_SECRET=...
```

#### çˆ¬è™«é…ç½®
```env
MERCURYDESK_RSSHUB_BASE_URL=https://rsshub.app
MERCURYDESK_SYNC_JOB_MAX_WORKERS=12
MERCURYDESK_CRAWLER_HEADLESS=false
MERCURYDESK_CRAWLER_USE_PERSISTENT_LOGIN=true
MERCURYDESK_CRAWLER_BROWSER_DATA_DIR=./browser_data
MERCURYDESK_CRAWLER_RSSHUB_PARALLELISM=12
MERCURYDESK_CRAWLER_PLAYWRIGHT_POLL_SECONDS=10
```

#### LLM æ¨¡å‹ç›®å½•
```env
MERCURYDESK_MODELS_CATALOG_URL=https://models.dev/api.json
MERCURYDESK_MODELS_CATALOG_REFRESH_SECONDS=3600
```

#### é‚®ä»¶è½¬å‘åŸŸå
```env
MERCURYDESK_FORWARD_INBOUND_DOMAIN=inbox.example.com
```

### å¿«é€Ÿå¯åŠ¨æŒ‡å—

#### åç«¯å¯åŠ¨
```powershell
cd backend
python -m pip install -r requirements.txt
python -m uvicorn app.main:app --reload --port 8000
```

#### å‰ç«¯å¯åŠ¨
```powershell
cd frontend
npm install
npm run dev
# è®¿é—® http://localhost:5173
```

#### æ•°æ®åº“åˆå§‹åŒ–
- SQLiteï¼šè‡ªåŠ¨åœ¨ `backend/mercurydesk.db` åˆ›å»º
- PostgreSQLï¼šéœ€æå‰åˆ›å»ºæ•°æ®åº“ï¼Œé…ç½® `MERCURYDESK_DATABASE_URL`

### æµ‹è¯•å‘½ä»¤

```powershell
# åç«¯å•å…ƒæµ‹è¯•
cd backend
pytest

# å‰ç«¯æµ‹è¯•
cd frontend
npm test
npm run build
```

---

## å¼€å‘å·¥ä½œæµ

### æ·»åŠ æ–°çš„æ•°æ®æºï¼ˆConnectorï¼‰

**æ­¥éª¤**ï¼š
1. åœ¨ `backend/app/connectors/` åˆ›å»ºæ–°æ–‡ä»¶ `myplatform.py`
2. ç»§æ‰¿ `BaseCrawler` å¹¶å®ç° `crawl()` æ–¹æ³•
3. è¿”å› `list[Message]` æˆ– `list[Contact]`
4. åœ¨ `sync.py` ä¸­æ³¨å†Œ Connector
5. åœ¨ `routers/accounts.py` æ·»åŠ é…ç½®ç«¯ç‚¹
6. åœ¨å‰ç«¯ `components/settings/sections/AccountsSection.tsx` æ·»åŠ  UI

### æ·»åŠ æ–°çš„ API ç«¯ç‚¹

**æ­¥éª¤**ï¼š
1. åœ¨ `routers/` ä¸­åˆ›å»ºæˆ–ä¿®æ”¹æ–‡ä»¶
2. ä½¿ç”¨ `@router.get()` / `@router.post()` è£…é¥°å™¨
3. å®šä¹‰è¯·æ±‚/å“åº” Schemaï¼ˆåœ¨ `schemas.py`ï¼‰
4. ä½¿ç”¨ CRUD å‡½æ•°è®¿é—®æ•°æ®åº“
5. åœ¨ `main.py` æ³¨å†Œè·¯ç”±
6. åœ¨å‰ç«¯ `api.ts` æ·»åŠ è°ƒç”¨å‡½æ•°

### æ·»åŠ æ–°çš„ Agent å·¥å…·

**æ­¥éª¤**ï¼š
1. åœ¨ `services/agent_tools.py` å®šä¹‰å·¥å…·å‡½æ•°
2. åœ¨å·¥å…·å‡½æ•°ä¸Šæ ‡æ³¨å‚æ•°ä¸è¿”å›ç±»å‹
3. åœ¨ `routers/agent.py` ä¸­æ³¨å†Œå·¥å…·
4. åœ¨ LLM Prompt ä¸­è¯´æ˜å·¥å…·ç”¨é€”
5. åœ¨å‰ç«¯ `AgentChatPanel.tsx` æ·»åŠ å·¥å…·é€‰æ‹© UIï¼ˆå¯é€‰ï¼‰

### ä¿®æ”¹ä¸»é¢˜

**æ­¥éª¤**ï¼š
1. ç¼–è¾‘ `frontend/src/theme.tsx`ï¼ˆMUI ä¸»é¢˜é…ç½®ï¼‰
2. ä¿®æ”¹é¢œè‰²ã€å­—ä½“ã€é—´è·ç­‰
3. ä¸»é¢˜åˆ‡æ¢é€»è¾‘åœ¨ `AppearanceSection.tsx`

### æ•°æ®åº“è¿ç§»

ç”±äºä½¿ç”¨ SQLiteï¼Œæš‚æ— å®Œæ•´è¿ç§»æ¡†æ¶ï¼Œä½†æœ‰ç®€å•çš„åˆ—æ·»åŠ è„šæœ¬ï¼š
```python
# backend/app/main.py - _add_missing_columns()
```

å¦‚æœéœ€è¦å¤æ‚è¿ç§»ï¼Œå»ºè®®ä½¿ç”¨ Alembicï¼š
```bash
pip install alembic
alembic init migrations
```

---

## é¡¹ç›®ç»Ÿè®¡

### ä»£ç è§„æ¨¡
- **æ€»è¡Œæ•°**: ~25,804 è¡Œ
- **Python ä»£ç **: ~7,457 è¡Œï¼ˆbackend/appï¼‰
- **TypeScript/TSX ä»£ç **: ~8,000+ è¡Œï¼ˆfrontend/srcï¼‰
- **æµ‹è¯•ä»£ç **: ~2,000+ è¡Œ
- **æ–‡æ¡£**: ~10,000+ è¡Œ

### æ–‡ä»¶ç»Ÿè®¡
| ç±»å‹ | æ•°é‡ |
|------|------|
| Python æ–‡ä»¶ | ~50+ |
| TypeScript/TSX æ–‡ä»¶ | ~40+ |
| é…ç½®æ–‡ä»¶ | 10+ |
| æ–‡æ¡£æ–‡ä»¶ | 10+ |
| æµ‹è¯•æ–‡ä»¶ | 8+ |

### ä¾èµ–ç»Ÿè®¡
| ç±»å‹ | æ•°é‡ |
|------|------|
| Python ä¾èµ– | 14 ä¸ªï¼ˆæ ¸å¿ƒï¼‰ |
| Node.js ä¾èµ– | 18 ä¸ª |

---

## å…³é”®è®¾è®¡å†³ç­–

### 1. **Connector æ¨¡å¼**
- æ¯ä¸ªæ•°æ®æºç‹¬ç«‹å®ç°ï¼Œä¾¿äºæ‰©å±•
- æ”¯æŒå¤šç­–ç•¥å›é€€ï¼Œæé«˜å¯é æ€§

### 2. **OAuth + Token åŒæ”¯æŒ**
- OAuthï¼šç”¨æˆ·å‹å¥½çš„ä¸€é”®æˆæƒ
- Tokenï¼šé¢å‘é«˜çº§ç”¨æˆ·çš„ç›´æ¥è¿æ¥

### 3. **æ¶ˆæ¯è§„èŒƒåŒ–**
- æ‰€æœ‰æ•°æ®æºçš„æ¶ˆæ¯ç»Ÿä¸€ä¸º `Message` æ¨¡å‹
- æ”¯æŒæŒ‰å‘ä¿¡äººèšåˆå±•ç¤º

### 4. **AI Agent ä½œä¸ºé™„åŠ åŠŸèƒ½**
- ç‹¬ç«‹çš„ `/api/v1/agent` è·¯ç”±
- å¯é€‰é…ç½®ï¼Œä¸å½±å“æ ¸å¿ƒæ¶ˆæ¯åŠŸèƒ½

### 5. **å‰ç«¯ SWR æ•°æ®è·å–**
- è‡ªåŠ¨ç¼“å­˜ä¸é‡æ–°éªŒè¯
- é™ä½ç½‘ç»œè¯·æ±‚é¢‘ç‡
- æ”¯æŒç¦»çº¿ä½¿ç”¨

### 6. **åŠ å¯†å­˜å‚¨æ•æ„Ÿä¿¡æ¯**
- ä½¿ç”¨ Fernetï¼ˆå¯¹ç§°åŠ å¯†ï¼‰
- å¯é€‰å¯ç”¨ï¼Œé€šè¿‡ `MERCURYDESK_FERNET_KEY` é…ç½®

---

## å·²çŸ¥å±€é™ä¸æ”¹è¿›æ–¹å‘

### å½“å‰å±€é™
1. âš ï¸ **SQLite é™åˆ¶**: ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨ PostgreSQL
2. âš ï¸ **çˆ¬è™«è„†å¼±æ€§**: ç½‘é¡µçˆ¬è™«æ˜“å—å¹³å° HTML ç»“æ„å˜åŒ–å½±å“
3. âš ï¸ **RSSHub ä¾èµ–**: æŸäº›å¹³å°çš„å›é€€ç­–ç•¥ä¾èµ–å¤–éƒ¨ RSSHub æœåŠ¡
4. âš ï¸ **Agent è®°å¿†å®¹é‡**: é•¿æœŸè®°å¿†æš‚æ— å®¹é‡é™åˆ¶ä¸å½’æ¡£æœºåˆ¶

### æ½œåœ¨æ”¹è¿›
- [ ] å®ç° Alembic æ•°æ®åº“è¿ç§»æ¡†æ¶
- [ ] æ·»åŠ æ¶ˆæ¯æœç´¢ç´¢å¼•ï¼ˆElasticsearch/Milvusï¼‰
- [ ] å®ç° Agent è®°å¿†çš„å‘é‡å­˜å‚¨ä¸è¯­ä¹‰æœç´¢
- [ ] æ”¯æŒæ¶ˆæ¯åŠ å¯†å­˜å‚¨
- [ ] å®ç°æ¶ˆæ¯å»é‡ä¸èšåˆç®—æ³•ä¼˜åŒ–
- [ ] æ·»åŠ æ¶ˆæ¯æ ‡ç­¾ä¸åˆ†ç±»ç³»ç»Ÿ
- [ ] æ”¯æŒè‡ªå®šä¹‰å·¥ä½œæµï¼ˆIFTTT é£æ ¼ï¼‰
- [ ] å®ç°æ¶ˆæ¯æ¨é€é€šçŸ¥ï¼ˆWebSocketï¼‰

---

## æ€»ç»“

**MercuryDesk** æ˜¯ä¸€ä¸ªè®¾è®¡ç²¾è‰¯çš„ä¸ªäººæ”¶ä»¶ç®±ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

âœ… **æ¶æ„æ¸…æ™°**ï¼šåˆ†å±‚è®¾è®¡ï¼ŒConnector æ¨¡å¼æ”¯æŒæ— é™æ‰©å±•  
âœ… **åŠŸèƒ½å®Œæ•´**ï¼šæ”¯æŒ 12+ æ•°æ®æºã€OAuth/Token è®¤è¯ã€AI Agentã€é‚®ä»¶è½¬å‘  
âœ… **æŠ€æœ¯å…ˆè¿›**ï¼šå¼‚æ­¥ä¼˜å…ˆã€ç±»å‹å®‰å…¨ã€ç°ä»£åŒ–å‰åç«¯æ ˆ  
âœ… **æ˜“äºéƒ¨ç½²**ï¼šé›¶é…ç½®å¯åŠ¨ï¼ˆSQLiteï¼‰ã€ç¯å¢ƒå˜é‡é©±åŠ¨  
âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šæ‚å¿—å¼å¡ç‰‡å¸ƒå±€ã€æµç•…åŠ¨ç”»ã€æ·±æµ…ä¸»é¢˜æ”¯æŒ  

é¡¹ç›®é€‚åˆä½œä¸ºï¼š
- ä¸ªäººç”Ÿäº§åŠ›å·¥å…·
- å¼€æºå­¦ä¹ é¡¹ç›®
- ä¼ä¸šå†…éƒ¨é€šçŸ¥èšåˆå¹³å°
- SaaS åº”ç”¨åŸå‹

---

**æ¢ç´¢å®Œæˆæ—¶é—´**: 2026-02-11  
**æ¢ç´¢çº§åˆ«**: Very Thorough âœ¨
